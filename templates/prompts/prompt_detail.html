{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<div class="template-page">
    <div class="template-hero">
        <div>
            <div class="template-eyebrow">Resume System</div>
            <h1 class="template-title">{{ prompt.name }}</h1>
            <p class="template-subtitle">System prompt details and layout.</p>
        </div>
        <div class="actions">
            <button type="button" id="copy-prompt" class="btn-secondary">Copy All</button>
            <a href="{% url 'prompt-edit' prompt.pk %}" class="btn-primary">Edit</a>
        </div>
    </div>

    <div class="template-grid">
        <div class="template-card">
            <h2 class="card-title">Prompt Meta</h2>
            <div class="meta-grid">
                <div class="meta-item">Temp <span>{{ prompt.temperature }}</span></div>
                <div class="meta-item">Max Tokens <span>{{ prompt.max_output_tokens }}</span></div>
                <div class="meta-item">Active <span>{% if prompt.is_active %}Yes{% else %}No{% endif %}</span></div>
                <div class="meta-item">Default <span>{% if prompt.is_default %}Yes{% else %}No{% endif %}</span></div>
            </div>
            <div class="meta-note">
                Required placeholders:
                <code>{job_title}</code> <code>{company}</code> <code>{job_description}</code>
                <code>{consultant_name}</code> <code>{consultant_bio}</code>
                <code>{consultant_skills}</code> <code>{experience_summary}</code> <code>{certifications}</code>
            </div>
            {% if prompt.description %}
            <div class="meta-desc">{{ prompt.description|safe }}</div>
            {% endif %}
        </div>

        <div class="template-card">
            <h2 class="card-title">System Text</h2>
            <textarea readonly id="prompt-system" class="textarea code">{{ prompt.system_text }}</textarea>
        </div>

        <div class="template-card">
            <h2 class="card-title">Template Text</h2>
            <textarea readonly id="prompt-template" class="textarea code">{{ prompt.template_text }}</textarea>
        </div>
    </div>
</div>

<style>
    :root {
        --ink: #0f172a;
        --muted: #64748b;
        --bg: #f4f2ee;
        --card: #ffffff;
        --accent: #0b5c9e;
        --border: #e2e8f0;
    }
    .template-page { background: var(--bg); min-height: 100vh; padding: 32px 24px 56px; }
    .template-hero { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .template-eyebrow { text-transform: uppercase; letter-spacing: 0.2em; font-size: 12px; color: var(--muted); }
    .template-title { font-size: 32px; font-weight: 800; color: var(--ink); margin: 6px 0; }
    .template-subtitle { color: var(--muted); font-size: 14px; }
    .template-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    .template-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 18px; box-shadow: 0 10px 30px rgba(15,23,42,0.06); }
    .card-title { font-size: 18px; font-weight: 700; color: var(--ink); margin-bottom: 12px; }
    .meta-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
    .meta-item { background: #f8fafc; border: 1px solid var(--border); padding: 10px; border-radius: 10px; font-size: 12px; color: var(--muted); display: flex; justify-content: space-between; }
    .meta-item span { font-weight: 700; color: var(--ink); }
    .meta-note { margin-top: 10px; font-size: 12px; color: var(--muted); }
    .meta-note code { background: #f1f5f9; padding: 2px 6px; border-radius: 6px; margin-right: 4px; }
    .meta-desc { margin-top: 10px; font-size: 14px; color: var(--ink); }
    .textarea.code { width: 100%; border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; min-height: 180px; background: #f8fafc; font-family: "IBM Plex Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .actions { display: flex; gap: 10px; }
    .btn-primary { background: var(--accent); color: #fff; border: 0; padding: 10px 14px; border-radius: 10px; font-weight: 700; text-decoration: none; }
    .btn-secondary { background: #e2e8f0; color: var(--ink); border: 0; padding: 10px 14px; border-radius: 10px; font-weight: 600; }
    @media (max-width: 640px) { .template-hero { flex-direction: column; align-items: flex-start; gap: 12px; } }
</style>

<script>
    (function () {
        const btn = document.getElementById('copy-prompt');
        if (!btn) return;
        btn.addEventListener('click', async () => {
            const systemText = document.getElementById('prompt-system')?.value || '';
            const templateText = document.getElementById('prompt-template')?.value || '';
            const all = `SYSTEM TEXT\\n${systemText}\\n\\nTEMPLATE TEXT\\n${templateText}`.trim();
            try {
                await navigator.clipboard.writeText(all);
                btn.textContent = 'Copied';
                setTimeout(() => btn.textContent = 'Copy All', 1500);
            } catch (e) {
                alert('Copy failed. Select text manually.');
            }
        });
    })();
</script>
{% endblock %}
