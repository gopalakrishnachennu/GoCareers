{% extends 'base.html' %}
{% load widget_tweaks %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 py-8">
    <div class="flex flex-wrap items-center justify-between gap-3 mb-4">
        <div>
            <h1 class="text-2xl font-semibold text-gray-900">{{ prompt.name }}</h1>
            <div class="text-sm text-gray-600 mt-1">{{ prompt.description|safe }}</div>
        </div>
        <div class="flex gap-2">
            <button type="button" id="copy-prompt"
                class="px-3 py-1.5 rounded border text-sm bg-white hover:bg-gray-50">Copy</button>
            <a href="{% url 'prompt-edit' prompt.pk %}"
                class="px-3 py-1.5 rounded border text-sm bg-white hover:bg-gray-50">Edit</a>
        </div>
    </div>

    <div class="border rounded-lg bg-white p-5">
        <div class="flex flex-wrap gap-3 text-xs text-gray-500 mb-4">
            <span>Temp: {{ prompt.temperature }}</span>
            <span>Max Tokens: {{ prompt.max_output_tokens }}</span>
            <span>Active: {% if prompt.is_active %}Yes{% else %}No{% endif %}</span>
            <span>Default: {% if prompt.is_default %}Yes{% else %}No{% endif %}</span>
        </div>

        <div class="text-xs text-gray-500 mb-3">
            Required placeholders: {job_title}, {company}, {job_description}, {consultant_name}, {consultant_bio}, {consultant_skills}, {experience_summary}, {certifications}
        </div>

        <div class="space-y-4">
            <div>
                <div class="text-xs font-semibold text-gray-700 mb-1">System Text</div>
                <textarea readonly id="prompt-system" class="w-full border rounded px-3 py-2 text-xs bg-gray-50 h-36 whitespace-pre-wrap">{{ prompt.system_text }}</textarea>
            </div>
            <div>
                <div class="text-xs font-semibold text-gray-700 mb-1">Template Text</div>
                <textarea readonly id="prompt-template" class="w-full border rounded px-3 py-2 text-xs bg-gray-50 h-52 whitespace-pre-wrap">{{ prompt.template_text }}</textarea>
            </div>
        </div>
    </div>
</div>

<script>
    (function () {
        const btn = document.getElementById('copy-prompt');
        if (!btn) return;
        btn.addEventListener('click', async () => {
            const systemText = document.getElementById('prompt-system')?.value || '';
            const templateText = document.getElementById('prompt-template')?.value || '';
            const all = `SYSTEM TEXT\\n${systemText}\\n\\nTEMPLATE TEXT\\n${templateText}`.trim();
            try {
                await navigator.clipboard.writeText(all);
                btn.textContent = 'Copied';
                setTimeout(() => btn.textContent = 'Copy All', 1500);
            } catch (e) {
                alert('Copy failed. Select text manually.');
            }
        });
    })();
</script>
{% endblock %}
